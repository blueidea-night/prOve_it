{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"/server/api/routers.js","filenameRelative":"/server/api/routers.js","env":{},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":false,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/server/api/routers.js.map","sourceFileName":"/server/api/routers.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"basename":"routers"},"ignored":false,"code":"if (Meteor.isServer) {\n  var fs = Npm.require(\"fs\"),\n      os = Npm.require(\"os\"),\n      path = Npm.require(\"path\");\n\n  Router.onBeforeAction(function (req, res, next) {\n    //    console.log(req.headers);\n    var files = []; // Store a file and then pass it to the request.\n\n    if (req.method === \"POST\" && parseInt(req.headers['content-length']) > 0) {\n      var busboy = new Busboy({\n        headers: req.headers\n      });\n      busboy.on(\"file\", function (fieldname, file, filename, encoding, mimetype) {\n        // var saveTo = path.join(os.tmpDir(), filename);\n        // var saveTo = path.join(process.cwd()+ \"/tmp/\", filename);\n        // var token = Random.id( 10 );\n        // req.token = token;\n        // var saveTo = path.join(process.env.PWD, \"private\", filename);\n        var fileSizeBytes = 0;\n        var contents = '';\n\n        // file.pipe(fs.createWriteStream(saveTo));\n        // var string = Assets.getText(filename);\n\n        file.on(\"data\", function (data) {\n          fileSizeBytes = fileSizeBytes + data.length;\n          contents += data;\n        });\n\n        file.on('end', function () {\n          // console.log(datas);\n          files.push({\n            fieldname: fieldname,\n            originalFilename: filename,\n            contents: contents,\n            size: fileSizeBytes\n          });\n        });\n      });\n      busboy.on(\"finish\", function () {\n        // Pass the file on to the request\n        // console.log(files);\n        req.files = files;\n        next();\n      });\n      // Pass request to busboy\n      req.pipe(busboy);\n    } else {\n      next();\n    }\n  });\n}\n\nRouter.route('/api/v1/event-study', function () {\n\n  this.response.setHeader('Access-Control-Allow-Origin', '*');\n\n  if (this.request.method === \"OPTIONS\") {\n    this.response.setHeader('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept');\n    this.response.setHeader('Access-Control-Allow-Methods', 'POST, PUT, GET, DELETE, OPTIONS');\n    this.response.end('Set OPTIONS.');\n  } else {\n    API.handleRequest(this, this.request.method);\n  }\n}, { where: 'server' });","ast":null,"map":{"version":3,"sources":["/server/api/routers.js"],"names":[],"mappings":"AAAA,IAAI,OAAO,QAAP,EAAiB;AACnB,MAAI,KAAK,IAAI,OAAJ,CAAY,IAAZ,CAAL;MACA,KAAK,IAAI,OAAJ,CAAY,IAAZ,CAAL;MACA,OAAO,IAAI,OAAJ,CAAY,MAAZ,CAAP,CAHe;;AAKnB,SAAO,cAAP,CAAsB,UAAS,GAAT,EAAc,GAAd,EAAmB,IAAnB,EAAyB;;AAE7C,QAAI,QAAQ,EAAR;;AAFyC,QAIzC,IAAI,MAAJ,KAAe,MAAf,IAAyB,SAAS,IAAI,OAAJ,CAAY,gBAAZ,CAAT,IAA0C,CAA1C,EAA6C;AACxE,UAAI,SAAS,IAAI,MAAJ,CAAW;AACpB,iBAAS,IAAI,OAAJ;OADA,CAAT,CADoE;AAIxE,aAAO,EAAP,CAAU,MAAV,EAAkB,UAAS,SAAT,EAAoB,IAApB,EAA0B,QAA1B,EAAoC,QAApC,EAA8C,QAA9C,EAAwD;;;;;;AAMxE,YAAI,gBAAgB,CAAhB,CANoE;AAOxE,YAAI,WAAW,EAAX;;;;;AAPoE,YAYxE,CAAK,EAAL,CAAQ,MAAR,EAAgB,UAAS,IAAT,EAAe;AAC7B,0BAAgB,gBAAgB,KAAK,MAAL,CADH;AAE7B,sBAAY,IAAZ,CAF6B;SAAf,CAAhB,CAZwE;;AAiBxE,aAAK,EAAL,CAAQ,KAAR,EAAe,YAAW;;AAExB,gBAAM,IAAN,CAAW;AACT,uBAAW,SAAX;AACA,8BAAkB,QAAlB;AACA,sBAAW,QAAX;AACA,kBAAM,aAAN;WAJF,EAFwB;SAAX,CAAf,CAjBwE;OAAxD,CAAlB,CAJwE;AA+BxE,aAAO,EAAP,CAAU,QAAV,EAAoB,YAAW;;;AAG7B,YAAI,KAAJ,GAAY,KAAZ,CAH6B;AAI7B,eAJ6B;OAAX,CAApB;;AA/BwE,SAsCxE,CAAI,IAAJ,CAAS,MAAT,EAtCwE;KAA1E,MAuCO;AACL,aADK;KAvCP;GAJoB,CAAtB,CALmB;CAArB;;AAsDA,OAAO,KAAP,CAAc,qBAAd,EAAqC,YAAW;;AAE9C,OAAK,QAAL,CAAc,SAAd,CAAyB,6BAAzB,EAAwD,GAAxD,EAF8C;;AAI9C,MAAK,KAAK,OAAL,CAAa,MAAb,KAAwB,SAAxB,EAAoC;AACvC,SAAK,QAAL,CAAc,SAAd,CAAyB,8BAAzB,EAAyD,gDAAzD,EADuC;AAEvC,SAAK,QAAL,CAAc,SAAd,CAAyB,8BAAzB,EAAyD,iCAAzD,EAFuC;AAGvC,SAAK,QAAL,CAAc,GAAd,CAAmB,cAAnB,EAHuC;GAAzC,MAIO;AACL,QAAI,aAAJ,CAAmB,IAAnB,EAAyB,KAAK,OAAL,CAAa,MAAb,CAAzB,CADK;GAJP;CAJmC,EAWlC,EAAE,OAAO,QAAP,EAXL","file":"/server/api/routers.js.map","sourcesContent":["if (Meteor.isServer) {\n  var fs = Npm.require(\"fs\"),\n      os = Npm.require(\"os\"),\n      path = Npm.require(\"path\");\n\n  Router.onBeforeAction(function(req, res, next) {\n//    console.log(req.headers);\n    var files = []; // Store a file and then pass it to the request.\n\n    if (req.method === \"POST\" && parseInt(req.headers['content-length']) > 0) {\n      var busboy = new Busboy({\n          headers: req.headers\n      });\n      busboy.on(\"file\", function(fieldname, file, filename, encoding, mimetype) {\n        // var saveTo = path.join(os.tmpDir(), filename);\n        // var saveTo = path.join(process.cwd()+ \"/tmp/\", filename);\n        // var token = Random.id( 10 );\n        // req.token = token;\n        // var saveTo = path.join(process.env.PWD, \"private\", filename);\n        var fileSizeBytes = 0;\n        var contents = '';\n\n        // file.pipe(fs.createWriteStream(saveTo));\n        // var string = Assets.getText(filename);\n\n        file.on(\"data\", function(data) {\n          fileSizeBytes = fileSizeBytes + data.length;\n          contents += data;\n        });\n\n        file.on('end', function() {\n          // console.log(datas);\n          files.push({\n            fieldname: fieldname,\n            originalFilename: filename,\n            contents : contents,\n            size: fileSizeBytes,\n          });\n        });\n      });\n      busboy.on(\"finish\", function() {\n        // Pass the file on to the request\n        // console.log(files);\n        req.files = files;\n        next();\n      });\n      // Pass request to busboy\n      req.pipe(busboy);\n    } else {\n      next();\n    }\n  });\n}\n\nRouter.route( '/api/v1/event-study', function() {\n\n  this.response.setHeader( 'Access-Control-Allow-Origin', '*' );\n\n  if ( this.request.method === \"OPTIONS\" ) {\n    this.response.setHeader( 'Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept' );\n    this.response.setHeader( 'Access-Control-Allow-Methods', 'POST, PUT, GET, DELETE, OPTIONS' );\n    this.response.end( 'Set OPTIONS.' );\n  } else {\n    API.handleRequest( this, this.request.method);\n  }\n}, { where: 'server' } );\n"]},"hash":"b513bb2e2401a57265020a296b1dd4b1dd82a1fd"}
